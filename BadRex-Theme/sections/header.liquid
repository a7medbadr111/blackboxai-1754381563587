{%- liquid
  assign main_menu = section.settings.menu
  assign header_transparent = section.settings.header_transparent
-%}

<script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'details-modal.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'cart-notification.js' | asset_url }}" defer="defer"></script>

<svg xmlns="http://www.w3.org/2000/svg" class="hidden">
  <defs>
    <symbol id="icon-search" viewBox="0 0 18 19" fill="none">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M11.03 11.68A5.784 5.784 0 112.85 3.5a5.784 5.784 0 018.18 8.18zm.26 1.12a6.78 6.78 0 11.72-.72l5.4 5.4a.5.5 0 11-.71.7l-5.41-5.38z" fill="currentColor"/>
    </symbol>
    <symbol id="icon-cart" viewBox="0 0 20 20" fill="none">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M8.5 16a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM17.5 16a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" fill="currentColor"/>
      <path d="M3 4h1.68l2.4 9.6a2 2 0 002 1.6h8.4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 8h12l-1 4H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
    <symbol id="icon-close" viewBox="0 0 18 17" fill="none">
      <path d="M.865 15.978a.5.5 0 00.707.707l7.433-7.431 7.579 7.282a.501.501 0 00.846-.37.5.5 0 00-.153-.351L9.712 8.546l7.417-7.416a.5.5 0 10-.707-.708L8.991 7.853 1.413.573a.5.5 0 10-.693.72l7.563 7.268-7.418 7.417z" fill="currentColor">
    </symbol>
    <symbol id="icon-menu" viewBox="0 0 20 16" fill="none">
      <path d="M0 1h20M0 8h20M0 15h20" stroke="currentColor" stroke-width="1.5"/>
    </symbol>
    <symbol id="icon-account" viewBox="0 0 18 19" fill="none">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M6 4.5a3 3 0 116 0 3 3 0 01-6 0zm3-4a4 4 0 100 8 4 4 0 000-8zm5.58 12.15c1.12.82 1.83 2.24 1.91 4.85H1.51c.08-2.6.79-4.03 1.9-4.85C4.66 11.75 6.5 11.5 9 11.5s4.35.26 5.58 1.15zM9 10.5c-2.5 0-4.65.24-6.17 1.35C1.27 12.98.5 14.93.5 18v.5h17V18c0-3.07-.77-5.02-2.33-6.15-1.52-1.1-3.67-1.35-6.17-1.35z" fill="currentColor"/>
    </symbol>
  </defs>
</svg>

<header class="header sticky top-0 z-50 w-full bg-card/95 backdrop-blur-lg border-b border-gray-600" data-header>
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16">
      
      {%- comment -%} Logo {%- endcomment -%}
      <div class="header__heading">
        <h1 class="header__heading-link h2 link link--text focus-inset">
          {%- if request.page_type == 'index' -%}
            <span class="h1">
          {%- endif -%}
          <a href="{{ routes.root_url }}" class="header__heading-link link link--text focus-inset flex items-center space-x-2 group">
            <div class="relative">
              <span class="text-2xl">üëë</span>
              <div class="absolute inset-0 bg-primary/20 blur-xl group-hover:bg-primary/40 transition-all"></div>
            </div>
            <span class="text-xl font-bold text-gradient">{{ shop.name | default: 'BadRex Store' }}</span>
          </a>
          {%- if request.page_type == 'index' -%}
            </span>
          {%- endif -%}
        </h1>
      </div>

      {%- comment -%} Search Bar - Desktop {%- endcomment -%}
      <div class="hidden md:flex flex-1 max-w-md mx-8">
        <div class="relative w-full">
          <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4" aria-hidden="true">
            <use href="#icon-search">
          </svg>
          <input
            type="search"
            name="q"
            placeholder="{{ 'layout.navigation.search' | t }}"
            class="input pl-10 bg-gray-800 border-gray-600 focus:border-primary w-full"
            data-search-input
          />
        </div>
      </div>

      {%- comment -%} Desktop Navigation {%- endcomment -%}
      <nav class="header__inline-menu hidden md:flex items-center space-x-6" role="navigation">
        {%- for link in main_menu.links -%}
          <a href="{{ link.url }}" class="header__menu-item list-menu__item link link--text focus-inset text-white hover:text-primary transition-colors"
             {% if link.current %} aria-current="page"{% endif %}>
            <span {%- if link.child_active %} class="header__active-menu-item"{% endif %}>
              {{ link.title | escape }}
            </span>
          </a>
        {%- endfor -%}
        
        {%- comment -%} Trust Badge {%- endcomment -%}
        <div class="flex items-center space-x-1 px-3 py-1 bg-success/10 rounded-full">
          <span class="text-xs">üõ°Ô∏è</span>
          <span class="text-xs text-success font-medium">{{ 'layout.navigation.verified' | t }}</span>
        </div>
      </nav>

      {%- comment -%} Right Actions {%- endcomment -%}
      <div class="header__icons flex items-center space-x-4">
        
        {%- comment -%} Language Switcher {%- endcomment -%}
        {%- render 'language-switcher' -%}

        {%- comment -%} Cart {%- endcomment -%}
        <a href="{{ routes.cart_url }}" class="header__icon header__icon--cart link focus-inset relative group" id="cart-icon-bubble">
          <svg class="h-5 w-5" aria-hidden="true">
            <use href="#icon-cart">
          </svg>
          <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
          {%- if cart != empty -%}
            <div class="cart-count-bubble absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 bg-primary text-white text-xs rounded-full" data-cart-count>
              {%- if cart.item_count < 100 -%}
                {{ cart.item_count }}
              {%- else -%}
                99+
              {%- endif -%}
            </div>
          {%- endif -%}
        </a>

        {%- comment -%} Account {%- endcomment -%}
        <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" class="header__icon header__icon--account link focus-inset">
          <svg class="h-5 w-5" aria-hidden="true">
            <use href="#icon-account">
          </svg>
          <span class="visually-hidden">
            {%- liquid
              if customer
                echo 'customer.account_fallback' | t
              else
                echo 'customer.log_in' | t
              endif
            -%}
          </span>
        </a>

        {%- comment -%} Mobile Menu Toggle {%- endcomment -%}
        <button type="button" class="header__icon header__icon--menu header__icon--summary link focus-inset md:hidden p-2" aria-expanded="false" data-mobile-menu-toggle>
          <svg class="h-5 w-5" aria-hidden="true">
            <use href="#icon-menu">
          </svg>
          <svg class="h-5 w-5 hidden" aria-hidden="true">
            <use href="#icon-close">
          </svg>
          <span class="visually-hidden">{{ 'sections.header.menu' | t }}</span>
        </button>
      </div>
    </div>

    {%- comment -%} Mobile Menu {%- endcomment -%}
    <div class="header__menu-mobile md:hidden border-t border-gray-600 py-4 hidden" data-mobile-menu>
      {%- comment -%} Mobile Search {%- endcomment -%}
      <div class="mb-4">
        <div class="relative">
          <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4" aria-hidden="true">
            <use href="#icon-search">
          </svg>
          <input
            type="search"
            name="q"
            placeholder="{{ 'layout.navigation.search' | t }}"
            class="input pl-10 bg-gray-800 border-gray-600 w-full"
            data-search-input
          />
        </div>
      </div>

      {%- comment -%} Mobile Navigation {%- endcomment -%}
      <nav class="header__menu-mobile-nav space-y-3" role="navigation">
        {%- for link in main_menu.links -%}
          <a href="{{ link.url }}" class="header__menu-item block py-2 text-white hover:text-primary transition-colors"
             {% if link.current %} aria-current="page"{% endif %}>
            {{ link.title | escape }}
          </a>
        {%- endfor -%}
      </nav>
    </div>
  </div>
</header>

<script>
  // Mobile menu functionality
  document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.querySelector('[data-mobile-menu-toggle]');
    const mobileMenu = document.querySelector('[data-mobile-menu]');
    const menuIcon = menuToggle.querySelector('svg:first-child');
    const closeIcon = menuToggle.querySelector('svg:last-child');

    if (menuToggle && mobileMenu) {
      menuToggle.addEventListener('click', function() {
        const isOpen = mobileMenu.classList.contains('hidden');
        
        if (isOpen) {
          mobileMenu.classList.remove('hidden');
          menuIcon.classList.add('hidden');
          closeIcon.classList.remove('hidden');
          menuToggle.setAttribute('aria-expanded', 'true');
        } else {
          mobileMenu.classList.add('hidden');
          menuIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
          menuToggle.setAttribute('aria-expanded', 'false');
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "t:sections.header.settings.menu.label"
    },
    {
      "type": "checkbox",
      "id": "header_transparent",
      "default": false,
      "label": "Make header transparent"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__1.content"
    },
    {
      "type": "checkbox",
      "id": "show_line_separator",
      "default": true,
      "label": "t:sections.header.settings.show_line_separator.label"
    },
    {
      "type": "checkbox",
      "id": "color_scheme",
      "default": "background-1",
      "label": "t:sections.header.settings.color_scheme.label",
      "options": [
        {
          "value": "accent-1",
          "label": "t:sections.header.settings.color_scheme.options__1.label"
        },
        {
          "value": "accent-2",
          "label": "t:sections.header.settings.color_scheme.options__2.label"
        },
        {
          "value": "background-1",
          "label": "t:sections.header.settings.color_scheme.options__3.label"
        },
        {
          "value": "background-2",
          "label": "t:sections.header.settings.color_scheme.options__4.label"
        },
        {
          "value": "inverse",
          "label": "t:sections.header.settings.color_scheme.options__5.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__3.content",
      "info": "t:sections.header.settings.header__4.info"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "default": true,
      "label": "t:sections.header.settings.enable_sticky_header.label"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__5.content"
    },
    {
      "type": "select",
      "id": "mobile_logo_position",
      "default": "center",
      "label": "t:sections.header.settings.mobile_logo_position.label",
      "options": [
        {
          "value": "left",
          "label": "t:sections.header.settings.mobile_logo_position.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.header.settings.mobile_logo_position.options__2.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__1.content"
    },
    {
      "type": "paragraph",
      "content": "t:sections.header.settings.paragraph.content"
    }
  ]
}
{% endschema %}
